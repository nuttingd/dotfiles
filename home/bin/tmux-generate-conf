#!/usr/bin/env bash

# tmux-generate-conf: Generate .tmux.conf from template using theme colors
# Usage: tmux-generate-conf [template] [output]

SCRIPT_DIR="$(dirname "$(readlink -f "$0" 2>/dev/null || echo "$0")")"
DOTFILES_HOME="$(dirname "$SCRIPT_DIR")"
TEMPLATE="${1:-$DOTFILES_HOME/.tmux.conf.template}"
OUTPUT="${2:-$HOME/.tmux.conf}"

# Load theme colors
source "$SCRIPT_DIR/tmux-theme"

# Read template and substitute variables
if [[ ! -f "$TEMPLATE" ]]; then
    echo "Error: Template not found: $TEMPLATE" >&2
    exit 1
fi

# Export all THEME_ variables for envsubst
export THEME_BASE THEME_SURFACE0 THEME_SURFACE1 THEME_TEXT
export THEME_MAUVE THEME_BLUE THEME_TEAL THEME_GREEN THEME_PINK
export THEME_SAPPHIRE THEME_LAVENDER THEME_YELLOW THEME_PEACH
export THEME_FG_DARK

# Generate config (only substitute THEME_ variables)
VARS='${THEME_BASE} ${THEME_SURFACE0} ${THEME_SURFACE1} ${THEME_TEXT}'
VARS+=' ${THEME_MAUVE} ${THEME_BLUE} ${THEME_TEAL} ${THEME_GREEN} ${THEME_PINK}'
VARS+=' ${THEME_SAPPHIRE} ${THEME_LAVENDER} ${THEME_YELLOW} ${THEME_PEACH}'
VARS+=' ${THEME_FG_DARK}'
envsubst "$VARS" < "$TEMPLATE" > "$OUTPUT"

echo "Generated $OUTPUT from $TEMPLATE"
echo "Reload tmux with: tmux source ~/.tmux.conf"
